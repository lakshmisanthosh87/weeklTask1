(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{Kn3gVl:function(e,t,n){"use strict";n.r(t),n.d(t,"clearAlgoliaEnrichmentData",(function(){return y})),n.d(t,"pushAlgoliaEvent",(function(){return h}));var o=n("I5bsJc"),c=n("Gotloh"),r=n("BNMGbr"),i=function(e,t,n,o){return new(n||(n=Promise))((function(c,r){function i(e){try{s(o.next(e))}catch(e){r(e)}}function u(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?c(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((o=o.apply(e,t||[])).next())}))};const u="/api/instamart/search/analytics";var s=n("jL/hQN"),a=n("2HHMiI"),p=function(e,t,n,o){return new(n||(n=Promise))((function(c,r){function i(e){try{s(o.next(e))}catch(e){r(e)}}function u(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?c(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((o=o.apply(e,t||[])).next())}))};const l=new Set;let d=null;const v={triggered:!1,timeId:null},y=()=>{d=null};function h(e,t=5e3){const n=function(e){let t=e;"pdp"===e.pageType&&e.productID===(null==d?void 0:d.productID)&&(t=Object.assign(Object.assign({},e),d));switch(e.eventType){case"click":t.eventName="Product Clicked";break;case"conversion":t.eventName="Product Added To Cart";break;case"view":t.eventName="Product Viewed"}return t}(e);var y;"ALGOLIA"===(y=n).searchSource&&y.queryID&&y.objectID&&("conversion"!==y.eventType||1===y.quantity)&&("search"===e.pageType&&"click"===e.eventType&&f(e),v.triggered||(v.triggered=!0,v.timeId=setTimeout(()=>{try{!function(){p(this,void 0,void 0,(function*(){const e=Array.from(l);l.clear(),v.triggered=!1;const t=function(e){let t={};t=e.reduce((e,n)=>{const o=`${n.eventType}<->${n.queryID}<->${n.pageType}`;return t[o]||(t[o]=[]),t[o].push(n),e},t);return Object.values(t).reduce((e,t)=>{let n=null;for(const o of t)n?n.objectIDs.length+o.objectIDs.length<=15?(n.objectIDs.push(...o.objectIDs),n.positions.push(...o.positions)):(e.push(n),n=o):n=o;return n&&e.push(n),e},[])}(e);try{yield function(e){return i(this,void 0,void 0,(function*(){return yield c.a.post(Object(r.a)(u),{searchEvents:e})}))}(t)}catch(e){}}))}()}catch(e){Object(a.c)(e)}},t)),l.add(function(e){var t,n;const c="conversion"===e.eventType?{eventSubtype:"addToCart"}:{};return Object.assign({userToken:s.a.getUserId(),eventType:e.eventType,queryID:null!==(t=e.queryID)&&void 0!==t?t:o.c,objectIDs:[e.objectID],positions:[null!=e.position?e.position+1:-1],query:null!==(n=e.query)&&void 0!==n?n:o.c,pageType:e.pageType,timestamp:Date.now(),eventName:e.eventName},c)}(n)))}const f=e=>{d={query:e.query,searchSource:e.searchSource,productID:e.productID,queryID:e.queryID,position:e.position}}}}]);
//# sourceMappingURL=instamart-algolia-events-helper.es6.e0884cb24078357b.js.map